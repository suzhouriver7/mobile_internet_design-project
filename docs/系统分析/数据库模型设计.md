**数据库版本**：v1.2**
****最后更新**：2025年12月8日**  **
**设计团队**：校园约伴系统开发组

# 数据库模型设计

## 用户模块表结构

### users（用户表）

**存储系统中所有用户的基础信息，包括普通用户与管理员。**

| **字段**          | **类型**         | **主外键** | **中文说明**                          |
| ----------------------- | ---------------------- | ---------------- | ------------------------------------------- |
| **id**            | **BIGINT**       | **主键**   | **用户唯一编号**                      |
| **email**         | **VARCHAR(100)** |                  | **邮箱（可用于登录与密码找回）**      |
| **password_hash** | **VARCHAR(255)** |                  | **加密后的密码，不能存明文**          |
| **nickname**      | **VARCHAR(50)**  |                  | **用户昵称（主页展示使用）**          |
| **avatar_url**    | **VARCHAR(255)** |                  | **用户头像图片 URL （存放图片路径）** |
| **signature**     | **VARCHAR(255)** |                  | **用户个性签名**                      |
| **user_type**     | **UserType**     |                  | **用户类型**                          |
| **created_at**    | **DATETIME**     |                  | **注册时间**                          |
| **updated_at**    | **DATETIME**     |                  | **信息更新时间**                      |

**用途说明：**

* **登录时可使用学号 / 手机号 / 邮箱任选其一**
* **主页展示头像、昵称、历史动态、订单**
* **user_type 用于区分管理员权限（删除动态和订单）**

# 预约订单模块

## orders（预约订单主表）

**存储用户发布的预约订单，用于找人一起参加活动。**

| **字段**           | **类型**         | **主外键**            | **中文说明**                 |
| ------------------------ | ---------------------- | --------------------------- | ---------------------------------- |
| **id**             | **BIGINT**       | **主键**              | **订单唯一 ID**              |
| **user_id**        | **BIGINT**       | **外键 → users(id)** | **发布订单的用户**           |
| **activity_type**  | **ActivityType** |                             | **活动类型**                 |
| **gender_require** | **GenderType**   |                             | **性别要求标签**             |
| **campus**         | **CampusType**   |                             | **校区**                     |
| **location**       | **VARCHAR(100)** |                             | **活动地点（如天街、操场）** |
| **start_time**     | **DATETIME**     |                             | **活动开始时间**             |
| **note**           | **VARCHAR(200)** |                             | **订单备注（少量文字说明）** |
| **max_people**     | **TINYINT**      |                             | **需要的人数上限**           |
| **current_people** | **TINYINT**      |                             | **当前加入的人数**           |
| **status**         | **OrderStatus**  |                             | **订单状态**                 |
| **created_at**     | **DATETIME**     |                             | **创建时间**                 |
| **updated_at**     | **DATETIME**     |                             | **更新时间**                 |

**用途说明：**

* **用户发布预约订单**
* **被别人查看、询问、接受**
* **状态用于前端过滤订单：待匹配、进行中、已完成、已过期**
* **约束：**

---

## order_apply（用户申请加入订单表）

**用于用户对订单发起申请，等待订单创建者审核。**

| **字段**       | **类型**        | **主外键**        | **中文说明**       |
| -------------------- | --------------------- | ----------------------- | ------------------------ |
| **id**         | **BIGINT**      | **主键**          | **申请记录 ID**    |
| **order_id**   | **BIGINT**      | **→ orders(id)** | **申请加入的订单** |
| **user_id**    | **BIGINT**      | **→ users(id)**  | **申请人**         |
| **status**     | **ApplyStatus** |                         | **申请状态**       |
| **created_at** | **DATETIME**    |                         | **申请时间**       |

**约束说明：**

* **一个用户只能对同一订单提交一次申请（UNIQUE(order_id, user_id)）**

---

## order_messages（订单交流问询表）

**用于记录"想了解订单的人"和"订单发布者"之间的问答。**

| **字段**        | **类型**     | **主外键**             | **中文说明**                       |
| --------------------- | ------------------ | ---------------------------- | ---------------------------------------- |
| **id**          | **BIGINT**   | **主键**               | **交流信息 ID**                    |
| **order_id**    | **BIGINT**   | **外键 → orders(id)** | **所属订单**                       |
| **sender_id**   | **BIGINT**   | **外键 → users(id)**  | **提问或回复的人**                 |
| **receiver_id** | **BIGINT**   | **外键 → users(id)**  | **接收消息的人（一般是订单作者）** |
| **content**     | **TEXT**     |                              | **聊天内容，例如"可以改时间吗？"** |
| **created_at**  | **DATETIME** |                              | **时间戳**                         |

**用途说明：**
** 模拟"订单聊天框"，满足询问、确认细节的需求。**

---

## order_accept（订单接受记录表）

**用于标记一个订单最终由谁接受。**

| **字段**        | **类型**     | **主外键**                   | **中文说明**          |
| --------------------- | ------------------ | ---------------------------------- | --------------------------- |
| **id**          | **BIGINT**   | **主键**                     | **接受记录 ID**       |
| **order_id**    | **BIGINT**   | **外键 → orders(id)，唯一** | **被接受的订单 ID**   |
| **accepter_id** | **BIGINT**   | **外键 → users(id)**        | **接受订单的用户 ID** |
| **accepted_at** | **DATETIME** |                                    | **接受时间**          |

**用途说明：**

* **一个订单只允许被一个用户接受**
* **发布者可根据问询内容决定让谁接受**
* **接受后订单状态可修改为"已完成"**

---

# 动态（帖子）模块

## content_nodes（动态/评论主表）

**统一存储动态和评论，ID 共享，评论可以对动态或其他评论回复。**

| **字段**       | **类型**          | **主外键**               | **中文说明**                                         |
| -------------------- | ----------------------- | ------------------------------ | ---------------------------------------------------------- |
| **id**         | **BIGINT**        | **主键**                 | **内容唯一 ID（动态或评论）**                        |
| **user_id**    | **BIGINT**        | **→ users(id)**         | **发布者**                                           |
| **parent_id**  | **BIGINT**        | **→ content_nodes(id)** | **父节点 ID（null 表示动态，非 null 表示评论回复）** |
| **order_id**   | **BIGINT**        | **→ orders(id)，可空**  | **动态引用的订单 ID，可空**                          |
| **type**       | **ContentType**   |                                | **内容类型**                                         |
| **content**    | **TEXT**          |                                | **文本内容**                                         |
| **media_type** | **MediaType**     |                                | **媒体类型**                                         |
| **status**     | **ContentStatus** |                                | **内容状态**                                         |
| **created_at** | **DATETIME**      |                                | **创建时间**                                         |
| **updated_at** | **DATETIME**      |                                | **更新时间**                                         |

**用途说明：**

* **动态 parent_id=null，type=0**
* **评论 parent_id=目标内容 ID，type=1**
* **评论可以对动态或其他评论进行回复**

---

## content_media（动态/评论媒体表）

**统一存储动态或评论的图片/视频。**

| **字段**       | **类型**         | **主外键**               | **中文说明**     |
| -------------------- | ---------------------- | ------------------------------ | ---------------------- |
| **id**         | **BIGINT**       | **主键**                 | **媒体文件 ID**  |
| **content_id** | **BIGINT**       | **→ content_nodes(id)** | **所属内容节点** |
| **media_type** | **MediaType**    |                                | **媒体类型**     |
| **url**        | **VARCHAR(255)** |                                | **文件 URL**     |
| **created_at** | **DATETIME**     |                                | **上传时间**     |

---

## content_likes（动态/评论点赞表）

**统一存储点赞信息，支持对动态或评论点赞。**

| **字段**                        | **类型**     | **主外键**                             | **中文说明**        |
| ------------------------------------- | ------------------ | -------------------------------------------- | ------------------------- |
| **id**                          | **BIGINT**   | **主键**                               | **点赞记录 ID**     |
| **content_id**                  | **BIGINT**   | **→ content_nodes(id)**               | **所点赞的内容 ID** |
| **user_id**                     | **BIGINT**   | **→ users(id)**                       | **点赞用户**        |
| **created_at**                  | **DATETIME** |                                              | **点赞时间**        |
| **UNIQUE(content_id, user_id)** |                    | **限制同一用户对同一内容只能点赞一次** |                           |

---

## 数据库枚举类型定义

### 用户类型（UserType）

```
 CREATE TYPE UserType AS ENUM (
     'NORMAL',      -- 0: 普通用户
     'ADMIN'        -- 1: 管理员
 );
```

### 活动类型（ActivityType）

```
 CREATE TYPE ActivityType AS ENUM (
     'BASKETBALL',  -- 0: 篮球
     'BADMINTON',   -- 1: 羽毛球
     'MEAL',        -- 2: 吃饭
     'STUDY',       -- 3: 自习
     'MOVIE',       -- 4: 看电影
     'RUNNING',     -- 5: 跑步
     'GAME',        -- 6: 游戏
     'OTHER'        -- 7: 其他活动
 );
```

### 性别要求（GenderType）

```
 CREATE TYPE GenderType AS ENUM (
     'MALE',        -- 0: 男
     'FEMALE',      -- 1: 女
     'ANY'          -- 2: 不限
 );
```

### 校区（CampusType）

```
 CREATE TYPE CampusType AS ENUM (
     'LIANGXIANG',  -- 0: 良乡校区
     'ZHONGGUANCUN',-- 1: 中关村校区
     'ZHUHAI',      -- 2: 珠海校区
     'XISHAN',      -- 3: 西山校区
     'OTHER_CAMPUS' -- 4: 其他校区
 );
```

### 订单状态（OrderStatus）

```
 CREATE TYPE OrderStatus AS ENUM (
     'PENDING',     -- 0: 待匹配
     'IN_PROGRESS', -- 1: 进行中
     'COMPLETED',   -- 2: 已完成
     'CANCELLED',   -- 3: 已取消
     'EXPIRED'      -- 4: 已过期
 );
```

### 申请状态（ApplyStatus）

```
 CREATE TYPE ApplyStatus AS ENUM (
     'PENDING_REVIEW',   -- 0: 待审核
     'APPROVED',         -- 1: 已通过
     'REJECTED',         -- 2: 已拒绝
     'CANCELLED_APPLY'   -- 3: 已取消
 );
```

### 内容类型（ContentType）

```
 CREATE TYPE ContentType AS ENUM (
     'POST',        -- 0: 动态
     'COMMENT'      -- 1: 评论
 );
```

### 媒体类型（MediaType）

```
 CREATE TYPE MediaType AS ENUM (
     'TEXT_ONLY',   -- 0: 纯文本
     'IMAGE',       -- 1: 图片
     'VIDEO'        -- 2: 视频
 );
```

### 内容状态（ContentStatus）

```
 CREATE TYPE ContentStatus AS ENUM (
     'NORMAL',      -- 0: 正常
     'DELETED',     -- 1: 已删除
     'PENDING',     -- 2: 待审核
     'REJECTED'     -- 3: 审核不通过
 );
```
